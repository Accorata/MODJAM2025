namespace = omnitemporal

@otc_time_anomaly_reward = 500

### Hidden Events ###
# Fired on choosing the Omnitemporal Ascension Perk
country_event = {
	id = omnitemporal.0
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_ascension_perk = otc_ap_omnitemporal
	}

	immediate = {
		# Set Variable to check Temporal Fabric gained from Physicists
		set_variable = {
			which = otc_physicist_temporal_fabric_produced
			value = 0
		}
		# Create Temporal Anomly Event Chain (maybe?...)
		begin_event_chain = {
			event_chain = otc_temporal_anomalies
			target = this
		}
		# Enable Chronological Studies Special Project if no Ancrel DLC
		country_event = {
			id = omnitemporal.2
		}
	}		
}

# Fired on Chronological Studies Minor Artifact Decision / Special Project
country_event = {
	id = omnitemporal.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_ascension_perk = otc_ap_omnitemporal
	}

	immediate = {
		otc_create_temporal_anomaly = yes
	}		
}

# Enable Chronological Studies Special Project if no Ancrel DLC
country_event = {
	id = omnitemporal.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_ancrel = no
		has_ascension_perk = otc_ap_omnitemporal
	}

	immediate = {
		capital_scope = {
			enable_special_project = {
				name = "otc_chronological_studies_project"
				location = this
				owner = root
			}
		}
	}		
}

### Temporal Anomalies ###
# (large to do)...
# Level 1
ship_event = {
	id = omnitemporal.1000
	title = omnitemporal.1000.name
	desc = omnitemporal.1000.desc
	picture = GFX_evt_ship_in_orbit_3
	show_sound = evn_ove_scholarium_cache_rare_tech
	location = from
	event_chain = otc_temporal_anomalies
	is_triggered_only = yes
	immediate = {
		leader = {
			kill_leader = {
				show_notification = no
			}
		}
	}
	option = {
		name = omnitemporal.1000.a
		custom_tooltip = omnitemporal.1000.a.tooltip
		add_resource = {
			otc_temporal_fabric = @otc_time_anomaly_reward
		}
		complete_crisis_objective = otc_crisobj_research_time_anomaly
		ai_chance = {
			factor = 1
		}
	}
}

ship_event = {
	id = omnitemporal.1001
	title = omnitemporal.1001.name
	desc = omnitemporal.1001.desc
	picture = GFX_evt_face_off_in_space
	show_sound = evn_ove_scholarium_cache_rare_tech
	location = from
	event_chain = otc_temporal_anomalies
	is_triggered_only = yes
	immediate = {
		random_owned_leader = {
			limit = {
				has_leader_flag = otc_completed_time_anomaly
				# not same as
			}
			set_event_target_as = otc_future_leader
			set_leader_flag = otc_temporal_clone
		}
		clone_leader = {
			target = event_target:otc_future_leader
		}
		# give them a ship

	}
	option = {
		name = omnitemporal.1001.a
		custom_tooltip = omnitemporal.1001.a.tooltip
		add_resource = {
			otc_temporal_fabric = @otc_time_anomaly_reward
		}
		complete_crisis_objective = otc_crisobj_research_time_anomaly
		ai_chance = {
			factor = 1
		}
	}
}


### Menace Objectives ###
# Menace Objective - Temporal Fabric Production
# Fired from on_action 'on_monthly_pulse'
event = {
	id = omnitemporal.5000
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_playable_country = {
			has_ascension_perk = otc_ap_omnitemporal
		}
	}

	immediate = {
		every_playable_country = {
			limit = {
				has_ascension_perk = otc_ap_omnitemporal
			}
			if = {
				limit = {
					NOT = {
						is_variable_set = otc_physicist_temporal_fabric_produced
					}

				}
				set_variable = {
					which = otc_physicist_temporal_fabric_produced
					value = 0
				}
			}
			export_resource_income_to_variable = {
				resource = otc_temporal_fabric
				variable = otc_physicist_temporal_fabric_produced
			}
			complete_crisis_objective = otc_crisobj_physicist_production
		}
	}
}